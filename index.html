<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MCA & MOP Calculator</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 1rem;
      background: #f5f5f7;
    }
    h1 {
      font-size: 1.2rem;
      text-align: center;
      margin-bottom: 1rem;
    }
    .card {
      background: #ffffff;
      padding: 1rem;
      border-radius: 0.75rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 1rem;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem 0.75rem;
    }
    label {
      font-size: 0.85rem;
      display: block;
      margin-bottom: 0.15rem;
    }
    input, select {
      width: 100%;
      padding: 0.4rem 0.5rem;
      border-radius: 0.5rem;
      border: 1px solid #ccc;
      font-size: 0.9rem;
      box-sizing: border-box;
    }
    button {
      width: 100%;
      padding: 0.6rem;
      border-radius: 0.75rem;
      border: none;
      font-size: 1rem;
      font-weight: 600;
      margin-top: 0.5rem;
      background: #007aff;
      color: #fff;
    }
    button:active {
      opacity: 0.8;
    }
    .results-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      margin-bottom: 0.3rem;
    }
    .label {
      font-weight: 500;
    }
    .value {
      font-family: Menlo, Consolas, monospace;
    }
    .section-title {
      font-weight: 600;
      margin: 0.5rem 0 0.25rem;
      font-size: 0.9rem;
      border-bottom: 1px solid #eee;
      padding-bottom: 0.15rem;
    }
    .note {
      font-size: 0.75rem;
      color: #666;
      margin-top: 0.4rem;
    }
  </style>
</head>
<body>
  <h1>MCA & MOP Calculator</h1>

  <div class="card">
    <div class="grid">
      <div>
        <label for="voltage">Unit Voltage (V)</label>
        <input id="voltage" type="number" inputmode="decimal" value="480" />
      </div>
      <div>
        <label for="phase">Phase</label>
        <select id="phase">
          <option value="1">1-Phase</option>
          <option value="3" selected>3-Phase</option>
        </select>
      </div>

      <div>
        <label for="heaterKw">Heater kW</label>
        <input id="heaterKw" type="number" inputmode="decimal" value="15" />
      </div>
      <div>
        <label for="motor1">Motor #1 Amps</label>
        <input id="motor1" type="number" inputmode="decimal" value="6.85" />
      </div>

      <div>
        <label for="motor2">Motor #2 Amps</label>
        <input id="motor2" type="number" inputmode="decimal" value="6.85" />
      </div>
    </div>

    <button type="button" onclick="runCalc()">Calculate</button>
    <div class="note">Tip: Enter 0 for any motor that doesn't exist.</div>
  </div>

  <div class="card" id="resultsCard">
    <div class="section-title">Currents</div>
    <div class="results-row">
      <div class="label">Heater Amps</div>
      <div class="value" id="heaterAmps">0.00 A</div>
    </div>
    <div class="results-row">
      <div class="label">Motor Total Amps</div>
      <div class="value" id="motorAmps">0.00 A</div>
    </div>
    <div class="results-row">
      <div class="label">Total Amps</div>
      <div class="value" id="totalAmps">0.00 A</div>
    </div>

    <div class="section-title">MCA (Minimum Circuit Ampacity)</div>
    <div class="results-row">
      <div class="label">Heater MCA</div>
      <div class="value" id="heaterMca">0.00 A</div>
    </div>
    <div class="results-row">
      <div class="label">Motor MCA</div>
      <div class="value" id="motorMca">0.00 A</div>
    </div>
    <div class="results-row">
      <div class="label">Total MCA</div>
      <div class="value" id="totalMca">0.00 A</div>
    </div>

    <div class="section-title">Protection & Wire</div>
    <div class="results-row">
      <div class="label">MOP (Max Overcurrent Protection)</div>
      <div class="value" id="mop">0 A</div>
    </div>
    <div class="results-row">
      <div class="label">Heater Fuse Size</div>
      <div class="value" id="heaterFuse">0 A</div>
    </div>
    <div class="results-row">
      <div class="label">Motor Fuse Size</div>
      <div class="value" id="motorFuse">0 A</div>
    </div>
    <div class="results-row">
      <div class="label">Recommended Wire Size</div>
      <div class="value" id="wireSize">â€“</div>
    </div>
  </div>

  <script>
    function toNumber(id) {
      const v = parseFloat(document.getElementById(id).value);
      return isNaN(v) ? 0 : v;
    }

    function floorTo5(x) {
      return Math.floor(x / 5) * 5;
    }

    function ceilTo5(x) {
      return Math.ceil(x / 5) * 5;
    }

    function runCalc() {
      const voltage = toNumber("voltage");
      const phase = parseInt(document.getElementById("phase").value, 10) || 1;
      const heaterKw = toNumber("heaterKw");
      const motor1 = toNumber("motor1");
      const motor2 = toNumber("motor2");

      // Heater amps
      let heaterAmps = 0;
      if (voltage > 0 && heaterKw > 0) {
        if (phase === 3) {
          heaterAmps = (heaterKw * 1000) / (voltage * 1.73);
        } else {
          heaterAmps = (heaterKw * 1000) / voltage;
        }
      }

      const motorTotal = motor1 + motor2;
      const totalAmps = heaterAmps + motorTotal;

      // MCA values
      const heaterMca = 1.25 * heaterAmps;
      const motorMca = 1.25 * motorTotal;
      const totalMca = 1.25 * (motorTotal + heaterAmps);

      // Wire size from total MCA (matches your K7 table)
      let wire;
      const k7 = totalMca;
      if (!isFinite(k7) || k7 <= 0) {
        wire = "N/A";
      } else if (k7 < 14) {
        wire = "18 AWG";
      } else if (k7 < 18) {
        wire = "16 AWG";
      } else if (k7 < 25) {
        wire = "14 AWG";
      } else if (k7 < 30) {
        wire = "12 AWG";
      } else if (k7 < 40) {
        wire = "12 AWG";
      } else if (k7 < 55) {
        wire = "8 AWG";
      } else if (k7 < 75) {
        wire = "6 AWG";
      } else {
        wire = "4 AWG";
      }

      // MOP logic
      const mMax = Math.max(motor1, motor2);
      const mMin = Math.min(motor1, motor2);
      let t7 = 2.25 * mMax + mMin + heaterAmps;   // Before filters
      let t9 = floorTo5(t7);                      // Filter 1
      let t11 = t9 < totalMca ? totalMca : t9;    // Filter 2
      let t12 = ceilTo5(t11);                     // Filter 3
      let mop = t12 < 15 ? 15 : t12;              // Minimum 15 A

      // Fuses
      const heaterFuse = heaterMca < 15 ? 15 : ceilTo5(heaterMca);
      const motorFuse = motorMca < 15 ? 15 : ceilTo5(motorMca);

      // Update UI
      document.getElementById("heaterAmps").textContent = heaterAmps.toFixed(2) + " A";
      document.getElementById("motorAmps").textContent = motorTotal.toFixed(2) + " A";
      document.getElementById("totalAmps").textContent = totalAmps.toFixed(2) + " A";

      document.getElementById("heaterMca").textContent = heaterMca.toFixed(2) + " A";
      document.getElementById("motorMca").textContent = motorMca.toFixed(2) + " A";
      document.getElementById("totalMca").textContent = totalMca.toFixed(2) + " A";

      document.getElementById("mop").textContent = Math.round(mop) + " A";
      document.getElementById("heaterFuse").textContent = Math.round(heaterFuse) + " A";
      document.getElementById("motorFuse").textContent = Math.round(motorFuse) + " A";
      document.getElementById("wireSize").textContent = wire;
    }

    // Run once with defaults
    runCalc();
  </script>
</body>
</html>
